<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Canlı HTML Önizleme</title>
  <style>
    :root{
      --bg:#1e1f26;
      --bg-2:#2a2d37;
      --text:#e7eaf0;
      --muted:#a6b0bf;
      --border:#3a3f4b;
      --accent:#23a559;
      --panel:#ffffff;
    }
    *{ box-sizing: border-box; }
    html,body{ height:100%; margin:0; }
    body{
      background: var(--bg);
      color: var(--text);
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      overflow: hidden;
    }

    .toolbar{
      height: 44px;
      display:flex; align-items:center; gap:12px;
      padding: 0 12px;
      background: var(--bg-2);
      border-bottom: 1px solid var(--border);
    }
    .title{ font-weight:600; letter-spacing:.2px; }
    .spacer{ flex:1; }
    .btn{
      background:#d9534f; color:#fff; border:0; cursor:pointer;
      padding:8px 12px; border-radius:6px; font-weight:600;
    }
    .btn:active{ transform: translateY(1px); }

    .split{
      height: calc(100% - 44px);
      display: grid;
      grid-template-columns: 50% 6px 1fr;
      min-width: 560px;
    }

    .left{
      background:#222633;
      border-right:1px solid var(--border);
      min-width:280px;
      display:flex;
    }
    .right{
      background: var(--panel);
      min-width:280px;
    }

    /* Basit satır numarası: sol sütun + textarea */
    .editor{
      display:grid; grid-template-columns: 48px 1fr; width:100%; height:100%;
    }
    .gutter{
      background:#1b1f2a; color:#8190a4;
      border-right:1px solid #141823;
      padding:14px 8px; font-size:12px; line-height:1.5;
      white-space:pre; user-select:none; overflow:hidden; text-align:right;
    }
    textarea{
      width:100%; height:100%; border:0; outline:none;
      background:transparent; color:var(--text);
      padding:14px; font-size:14px; line-height:1.5; resize:none; tab-size:2;
      caret-color:#7bd88f; overflow:auto; white-space:pre;
    }
    .resizer{
      background: linear-gradient(to right, transparent, #4c525f 50%, transparent);
      cursor: col-resize;
    }
    iframe{
      width:100%; height:100%; border:0; background:white;
    }

    /* Küçük ekran düzeni */
    @media (max-width: 900px){
      .split{ display:flex; flex-direction:column; min-width:0; }
      .resizer{ height:6px; width:100%; cursor:row-resize; }
      .left{ height:55%; border-right:0; border-bottom:1px solid var(--border); }
      .right{ height:45%; }
    }
  </style>
</head>
<body>
  <div class="toolbar">
    <span class="title">Canlı HTML Önizleme</span>
    <span style="color:var(--muted); font-size:12px;">Sol: Kod / Sağ: Önizleme — anında güncellenir</span>
    <div class="spacer"></div>
    <button id="clearBtn" class="btn" title="Editörü temizle">Temizle</button>
  </div>

  <div class="split" id="splitWrap">
    <section class="left" id="leftPane">
      <div class="editor">
        <pre id="gutter" class="gutter">1</pre>
        <textarea id="code" spellcheck="false" placeholder="HTML kodunuzu buraya yazın ya da yapıştırın..."></textarea>
      </div>
    </section>
    <div class="resizer" id="resizer" aria-hidden="true"></div>
    <section class="right">
      <!-- Script’lerin çalışabilmesi için allow-scripts açık. İstersen kapatabilirsin. -->
      <iframe id="preview" sandbox="allow-scripts allow-forms allow-pointer-lock allow-modals allow-popups allow-popups-to-escape-sandbox"></iframe>
    </section>
  </div>

  <script>
    const codeEl = document.getElementById('code');
    const gutter = document.getElementById('gutter');
    const iframe = document.getElementById('preview');
    const clearBtn = document.getElementById('clearBtn');

    const DEFAULT_SNIPPET = `<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8">
  <title>Örnek</title>
  <style>
    body{font:16px/1.6 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; padding:24px}
    h1{margin:0 0 12px}
    .kutu{padding:12px; border:1px solid #ddd; border-radius:8px; background:#fafafa}
  </style>
</head>
<body>
  <h1>Bu bir Başlık</h1>
  <p>Bu bir paragraf.</p>
  <div class="kutu">Canlı önizleme örneği.</div>
  <script>console.log("Önizleme hazır");<\/script>
</body>
</html>`;

    // <html> yoksa otomatik sarmala (sadece body içeriği yapıştıranlar için)
    function wrapIfNeeded(src){
      const t = (src || "").trim();
      if(/<!doctype/i.test(t) || /<html[\s>]/i.test(t)) return t;
      return `<!doctype html>
<html lang="tr">
<head><meta charset="utf-8"><title>Önizleme</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>body{font:16px/1.6 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; padding:24px}</style>
</head><body>
${t || "<p>Boş belge.</p>"}
</body></html>`;
    }

    // Debounce
    function debounce(fn, wait=120){ let t; return (...a)=>{clearTimeout(t); t=setTimeout(()=>fn(...a), wait)}}

    // Önizleme güncelle
    const updatePreview = debounce(()=>{
      iframe.srcdoc = wrapIfNeeded(codeEl.value);
      localStorage.setItem('live_html_minimal', codeEl.value);
    }, 100);

    // Satır numaralarını güncelle
    function updateGutter(){
      const lines = (codeEl.value.match(/\n/g) || []).length + 1;
      let buf = "";
      for(let i=1;i<=lines;i++) buf += i + (i===lines ? "" : "\n");
      gutter.textContent = buf;
      gutter.scrollTop = codeEl.scrollTop;
    }

    // İlk yükleme
    (function init(){
      const saved = localStorage.getItem('live_html_minimal');
      codeEl.value = saved ?? DEFAULT_SNIPPET;
      updateGutter();
      iframe.srcdoc = wrapIfNeeded(codeEl.value);
      codeEl.addEventListener('input', ()=>{ updateGutter(); updatePreview(); });
      codeEl.addEventListener('scroll', ()=>{ gutter.scrollTop = codeEl.scrollTop; });
      codeEl.addEventListener('paste', ()=> setTimeout(()=>{ updateGutter(); updatePreview(); },0));
    })();

    // Temizle
    clearBtn.addEventListener('click', ()=>{
      codeEl.value = "";
      updateGutter();
      updatePreview();
    });

    // ------- Sürüklenebilir bölücü (yatay) -------
    const wrap = document.getElementById('splitWrap');
    const resizer = document.getElementById('resizer');
    const leftPane = document.getElementById('leftPane');

    let dragging = false;
    let lastX = 0;

    function setCols(px){
      const rect = wrap.getBoundingClientRect();
      const min = 280;                          // minimum panel genişliği
      const max = rect.width - 280;             // sağ panel için de min bırak
      const x = Math.max(min, Math.min(px, max));
      const leftPct = (x / rect.width) * 100;
      wrap.style.gridTemplateColumns = `${leftPct}% 6px 1fr`;
    }

    // Masaüstü
    resizer.addEventListener('mousedown', (e)=>{
      dragging = true; lastX = e.clientX;
      document.body.style.cursor = 'col-resize';
      e.preventDefault();
    });
    window.addEventListener('mousemove', (e)=>{
      if(!dragging) return;
      const rect = wrap.getBoundingClientRect();
      setCols(e.clientX - rect.left);
    });
    window.addEventListener('mouseup', ()=>{
      dragging = false;
      document.body.style.cursor = '';
    });

    // Dokunmatik
    resizer.addEventListener('touchstart', (e)=>{
      dragging = true;
      document.body.style.cursor = 'col-resize';
      lastX = e.touches[0].clientX;
    }, {passive:true});
    window.addEventListener('touchmove', (e)=>{
      if(!dragging) return;
      const rect = wrap.getBoundingClientRect();
      setCols(e.touches[0].clientX - rect.left);
    }, {passive:true});
    window.addEventListener('touchend', ()=>{
      dragging = false;
      document.body.style.cursor = '';
    });

    // Kısayol: Ctrl/Cmd+S güncellemeyi tetikler (kaydetme yok; sadece refresh)
    window.addEventListener('keydown', (e)=>{
      if((e.ctrlKey || e.metaKey) && e.key.toLowerCase()==='s'){
        e.preventDefault(); updatePreview();
      }
    });
  </script>
</body>
</html>
